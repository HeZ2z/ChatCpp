# 引言

## 项目概述与目的

本项目实现了一个基于WebSocket协议的实时聊天应用程序，采用C++语言开发，旨在提供高性能、低延迟的跨平台通信解决方案。该项目运用现代C++（C++17/20）特性，结合面向对象和异步编程模式，构建了一个可靠、可扩展的客户端-服务器架构。

### 聊天应用程序的主要功能

- 支持多用户实时聊天。
- 消息日志记录，所有消息会被保存到文件中以便后续分析。
- 历史记录加载，在用户登录时自动加载之前的聊天记录。
- 自动重连机制，确保在网络中断后能够重新连接到服务器。

---

## 系统架构

### 客户端-服务器模型概述

本项目采用客户端-服务器模型，客户端通过WebSocket协议与服务器进行双向通信。服务器负责处理所有客户端的连接、消息转发和历史记录存储。客户端则负责用户输入、消息展示和与服务器的交互。

### 通信协议（WebSockets）

WebSocket协议是一种在单个TCP连接上进行全双工通信的协议，适用于实时应用程序。它允许客户端和服务器之间进行低延迟的数据交换，适合聊天应用程序的需求。

### 组件图

![组件图](path/to/component_diagram.png)  
*注：请参考项目的组件图以了解各模块之间的关系。*

---

## 实现细节

### 服务器实现

#### 服务器中的主要功能

1. **WebSocket 连接管理**
   - 处理客户端的连接、断开和消息收发。
   - 在 `websocket_server.cpp` 中定义了事件处理器，例如 `onOpen` 和 `onClose` 方法，用于管理连接状态。

2. **消息广播**
   - 将收到的消息转发给所有已连接的客户端。
   - 使用 `broadcast` 方法实现消息广播。

3. **消息持久化**
   - 将消息保存到文件中，以便后续加载和显示历史记录。
   - 在 `src/server/main.cpp` 中实现了 `saveHistory` 方法。

4. **日志记录**
   - 记录服务器运行过程中的关键事件，便于调试和分析。
   - 使用 `logger.cpp` 中的日志系统。

---

### 客户端实现

#### 位于 `websocket_client.hpp` 中的 WebSocket 客户端类

客户端的核心功能包括以下部分：

1. **连接管理**
   - 通过 `connect` 方法连接到服务器，并在新线程中运行事件循环。
   - 在 `websocket_client.cpp` 中实现了 `connect` 方法。

2. **消息发送与接收**
   - 通过 `send` 方法发送消息，通过回调函数处理接收到的消息。

3. **状态检查**
   - 提供 `isConnected` 方法检查当前连接状态。

4. **自动重连**
   - 在网络中断后尝试重新连接到服务器。
   - 在 `main.cpp` 中实现了自动重连逻辑。

#### 位于 `main.cpp` 中的客户端主应用程序

- 主程序负责初始化客户端实例，启动事件循环，并处理用户输入。
- 提供命令行界面，用户可以通过输入内容发送消息或执行特定命令（如退出）。

---

### 公共工具

#### 位于 `logger.cpp` 中的日志系统

日志系统提供了以下功能：

1. **日志级别管理**
   - 支持不同级别的日志输出（如调试、信息、警告、错误）。

2. **日志文件记录**
   - 将日志信息写入指定文件，便于后续分析。

---

## 构建系统

### 位于 `CMakeLists.txt` 中的 CMake 配置

CMake 配置文件定义了项目的构建规则，包括源文件列表、依赖项和编译选项。

### # 引言

## 项目概述与目的

本项目实现了一个基于WebSocket协议的实时聊天应用程序，采用C++语言开发，旨在提供高性能、低延迟的跨平台通信解决方案。该项目运用现代C++（C++17/20）特性，结合面向对象和异步编程模式，构建了一个可靠、可扩展的客户端-服务器架构。

### 聊天应用程序的主要功能

- 支持多用户实时聊天。
- 消息日志记录，所有消息会被保存到文件中以便后续分析。
- 历史记录加载，在用户登录时自动加载之前的聊天记录。
- 自动重连机制，确保在网络中断后能够重新连接到服务器。

---

## 系统架构

### 客户端-服务器模型概述

本项目采用客户端-服务器模型，客户端通过WebSocket协议与服务器进行双向通信。服务器负责处理所有客户端的连接、消息转发和历史记录存储。客户端则负责用户输入、消息展示和与服务器的交互。

### 通信协议（WebSockets）

WebSocket协议是一种在单个TCP连接上进行全双工通信的协议，适用于实时应用程序。它允许客户端和服务器之间进行低延迟的数据交换，适合聊天应用程序的需求。

### 组件图

![组件图](path/to/component_diagram.png)  
*注：请参考项目的组件图以了解各模块之间的关系。*

---

## 实现细节

### 服务器实现

#### 服务器中的主要功能

1. **WebSocket 连接管理**
   - 处理客户端的连接、断开和消息收发。
   - 在 `websocket_server.cpp` 中定义了事件处理器，例如 `onOpen` 和 `onClose` 方法，用于管理连接状态。

2. **消息广播**
   - 将收到的消息转发给所有已连接的客户端。
   - 使用 `broadcast` 方法实现消息广播。

3. **消息持久化**
   - 将消息保存到文件中，以便后续加载和显示历史记录。
   - 在 `src/server/main.cpp` 中实现了 `saveHistory` 方法。

4. **日志记录**
   - 记录服务器运行过程中的关键事件，便于调试和分析。
   - 使用 `logger.cpp` 中的日志系统。

---

### 客户端实现

#### 位于 `websocket_client.hpp` 中的 WebSocket 客户端类

客户端的核心功能包括以下部分：

1. **连接管理**
   - 通过 `connect` 方法连接到服务器，并在新线程中运行事件循环。
   - 在 `websocket_client.cpp` 中实现了 `connect` 方法。

2. **消息发送与接收**
   - 通过 `send` 方法发送消息，通过回调函数处理接收到的消息。

3. **状态检查**
   - 提供 `isConnected` 方法检查当前连接状态。

4. **自动重连**
   - 在网络中断后尝试重新连接到服务器。
   - 在 `main.cpp` 中实现了自动重连逻辑。

#### 位于 `main.cpp` 中的客户端主应用程序

- 主程序负责初始化客户端实例，启动事件循环，并处理用户输入。
- 提供命令行界面，用户可以通过输入内容发送消息或执行特定命令（如退出）。

---

### 公共工具

#### 位于 `logger.cpp` 中的日志系统

日志系统提供了以下功能：

1. **日志级别管理**
   - 支持不同级别的日志输出（如调试、信息、警告、错误）。

2. **日志文件记录**
   - 将日志信息写入指定文件，便于后续分析。

---

## 构建系统

### 位于 `CMakeLists.txt` 中的 CMake 配置

CMake 配置文件定义了项目的构建规则，包括源文件列表、依赖项和编译选项。

### 构建过程及依赖项

1. **依赖项**
   - 使用 `websocketpp` 库实现 WebSocket 功能。
   - 使用 `Boost.Asio` 库处理异步操作。

2. **构建步骤**
   - 创建构建目录：`mkdir -p build && cd build`
   - 配置和编译：`cmake .. && make`

---

## 测试与结果

### 测试方法

1. **功能测试**
   - 验证消息发送、接收和历史记录功能是否正常工作。
   - 使用多个客户端同时连接到服务器，测试消息广播功能。

2. **性能测试**
   - 评估服务器在高并发场景下的表现。
   - 使用压力测试工具模拟大量客户端连接。

### 性能评估

1. **吞吐量**
   - 测试服务器每秒能够处理的消息数量。

2. **延迟**
   - 测量消息从发送到接收的时间间隔。

### 日志分析

参考 `build/` 目录中的日志文件，分析服务器和客户端的运行情况。

---

## 结论与未来工作

### 成果总结

本项目成功实现了基于 WebSocket 的实时聊天系统，具备高性能、低延迟和良好的用户体验。

### 潜在改进方向

1. **安全性增强**
   - 支持 WSS 加密连接以提高通信安全性。

2. **用户认证**
   - 引入用户身份验证机制，防止未经授权的访问。

3. **图形界面**
   - 开发图形用户界面，提升用户体验。

4. **多平台支持**
   - 优化代码以支持更多操作系统和硬件平台。

5. **性能优化**
   - 进一步优化服务器的并发处理能力，降低延迟。

1. **依赖项**
   - 使用 `websocketpp` 库实现 WebSocket 功能。
   - 使用 `Boost.Asio` 库处理异步操作。

2. **构建步骤**
   - 创建构建目录：`mkdir -p build && cd build`
   - 配置和编译：`cmake .. && make`

---

## 测试与结果

### 测试方法

1. **功能测试**
   - 验证消息发送、接收和历史记录功能是否正常工作。
   - 使用多个客户端同时连接到服务器，测试消息广播功能。

2. **性能测试**
   - 评估服务器在高并发场景下的表现。
   - 使用压力测试工具模拟大量客户端连接。

### 性能评估

1. **吞吐量**
   - 测试服务器每秒能够处理的消息数量。

2. **延迟**
   - 测量消息从发送到接收的时间间隔。

### 日志分析

参考 `build/` 目录中的日志文件，分析服务器和客户端的运行情况。

---

## 结论与未来工作

### 成果总结

本项目成功实现了基于 WebSocket 的实时聊天系统，具备高性能、低延迟和良好的用户体验。

### 潜在改进方向

1. **安全性增强**
   - 支持 WSS 加密连接以提高通信安全性。

2. **用户认证**
   - 引入用户身份验证机制，防止未经授权的访问。

3. **图形界面**
   - 开发图形用户界面，提升用户体验。

4. **多平台支持**
   - 优化代码以支持更多操作系统和硬件平台。

5. **性能优化**
   - 进一步优化服务器的并发处理能力，降低延迟。